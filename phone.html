<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="icon" type="image/png" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/android-chrome-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="196x196" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-196x196.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/apple-touch-icon-57x57.png">
    <link rel="icon" type="image/png" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/favicon-16x16.png" sizes="16x16">
    <link rel="shortcut icon" href="http://cdnyunphone.shinegame.cn/webh5/assets/images/splash/favicon.ico" type="image/x-icon" />


	<title>云挂机</title>
	<link href="http://cdnyunphone.shinegame.cn/device/test/assets/css/jquery-ui.css" rel="stylesheet" type="text/css"/>
	<link href="http://cdnyunphone.shinegame.cn/device/test/assets/css/webkey.css" rel="stylesheet" type="text/css"/>
	<link href="http://cdnyunphone.shinegame.cn/device/test/assets/css/macket.css" rel="stylesheet" type="text/css"/>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/jquery.js"></script>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/webkey.js"></script>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/screenshot.js"></script>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/json2.js"></script>
	<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/macket.js"></script>
    <script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/ripple.js"></script>
</head>
<body style="height:100%" ontouchmove="event.preventDefault()">
    <div id= "music_area"></div>
    <audio id="audio1" src="http://cdnyunphone.shinegame.cn/device/test/assets/res/touch.wav" preload="auto" autobuffer ></audio>
    <div id="dialog-confirm" class="ui-dialog" >
        <p>
        <span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>
        体验结束。
        </p>
    </div>
    <div id="dialog-confirm2" class="ui-dialog" >
        <p>
        <span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>
        网络不稳定。
        </p>
    </div>
<script type="text/javascript">
	var lastClick = 0;
	var runningConns = 0;
	var id = 0;
	$(document).ready(function()
	{
	
	$('#rightpart').resizable({ handles: 'w', minWidth: 250 }); 

	//if (getCookie("sms") == "true")
	//	document.getElementById('sms').checked = true;
	//if (getCookie("sendtyping") == "false")
	//	document.getElementById('sendtyping').checked = false;
	//if (getCookie("sendonenter") == "true")
	//	document.getElementById('sendonenter').checked = true;

	//if (getCookie("lowres") == "true")
	//	document.getElementById('lowres').checked = true;
	//if (getCookie("halfsize") == "true")
	//	document.getElementById('halfsize').checked = true;
	//if (getCookie("lowres") == "")
		document.getElementById('lowres').checked = true;
	//if (getCookie("halfsize") == "")
		document.getElementById('halfsize').checked = true;
	if (getCookie("orient") == "true")
		document.getElementById('orient').checked = true;
	if (getCookie("flip") == "true")
		document.getElementById('flip').checked = true;
	//if (getCookie("gamemode") == "true")
	//{
	//	document.getElementById('gamemode').checked = true;
	//	$('#text').attr('disabled',true);
	//}
//	if (getCookie("old") == "true")
//		document.getElementById('old').checked = true;
	//if (getCookie("first") == "true")
		document.getElementById('first').checked = true;
	//if (getCookie("png") == "true")
		document.getElementById('png').checked = false;
	//if (getCookie("auto") == "true")
	//{
		document.getElementById('auto').checked = true;
		setTimeout("refreshImage(false)",200);
	//}

    //if (getCookie("kalive") == "true")
	document.getElementById('kalive').checked = true;
	if (getCookie("auto")=="")
	{
		document.getElementById('auto').checked = true;
		setTimeout("refreshImage(false)",200);
	}
	if (getCookie("kalive")=="")
	document.getElementById('kalive').checked = true;

//	if (getCookie("forcems")!="")
//		document.getElementById('forcems').value = getCookie("forcems");
//	else
//		document.getElementById('forcems').value = getCookie("1000");
//	if (getCookie("force")=="true")
//	{
//		document.getElementById('force').checked = true;
//		forcerefresh();
//	}
	});


	var preload = new Image();
	preload.src = "down.png";
	preload.src = "up.png";
	preload.src = "left.png";
	preload.src = "right.png";
	preload.src = "center.png";

   var img;
   var recording = false;

   var http_request = false;
   var KMhttp_request = false;
   var pressed = false;
   var moveevent = "";
   var wait = false;
   var Mqueue = false;
   var Kqueue = false;
   var firsttype = true;
   var refrid = 0;
 //  var forcerefrid = 0;
   var keyq = '';
   var lasturl = '';
   var lasturlcount = 0;
   var ignore_backspace = 0;
   function makeRequest(url, parameters) {
      http_request = false;
      if (window.XMLHttpRequest) { // Mozilla, Safari,...
         http_request = new XMLHttpRequest();
         if (http_request.overrideMimeType) {
            http_request.overrideMimeType('text/xml');
         }
      } else if (window.ActiveXObject) { // IE
         try {
            http_request = new ActiveXObject("Msxml2.XMLHTTP");
         } catch (e) {
            try {
               http_request = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
         }
      }
      if (!http_request) {
         alert('Cannot create XMLHTTP instance');
         return false;
      }
      if(url !== "button_28"){
          http_request.onreadystatechange = alertContents;
      }
      http_request.open('GET', url + parameters, true);
      markYellow();
	//document.getElementById('ind').className = 'yellow';
      http_request.send(null);
   }
   function recordmakeRequest(url, parameters) {
      recordhttp_request = false;
      if (window.XMLHttpRequest) { // Mozilla, Safari,...
         recordhttp_request = new XMLHttpRequest();
         if (recordhttp_request.overrideMimeType) {
            recordhttp_request.overrideMimeType('text/xml');
         }
      } else if (window.ActiveXObject) { // IE
         try {
            recordhttp_request = new ActiveXObject("Msxml2.XMLHTTP");
         } catch (e) {
            try {
               recordhttp_request = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
         }
      }
      if (!recordhttp_request) {
         alert('Cannot create XMLHTTP instance');
         return false;
      }
      recordhttp_request.open('GET', url + parameters, true);
      recordhttp_request.send(null);
   }
   function lightmakeRequest(url, parameters) {
      lighthttp_request = false;
      if (window.XMLHttpRequest) { // Mozilla, Safari,...
         lighthttp_request = new XMLHttpRequest();
         if (lighthttp_request.overrideMimeType) {
            lighthttp_request.overrideMimeType('text/xml');
         }
      } else if (window.ActiveXObject) { // IE
         try {
            lighthttp_request = new ActiveXObject("Msxml2.XMLHTTP");
         } catch (e) {
            try {
               lighthttp_request = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
         }
      }
      if (!lighthttp_request) {
         alert('Cannot create XMLHTTP instance');
         return false;
      }
      //lighthttp_request.onreadystatechange = alertContents;
      lighthttp_request.open('GET', url + parameters, true);
      lighthttp_request.send(null);
   }
   function KMmakeRequest(url, parameters,method) {
      KMhttp_request = false;
      if (window.XMLHttpRequest) { // Mozilla, Safari,...
         KMhttp_request = new XMLHttpRequest();
         if (KMhttp_request.overrideMimeType) {
            KMhttp_request.overrideMimeType('text/xml');
         }
      } else if (window.ActiveXObject) { // IE
         try {
            KMhttp_request = new ActiveXObject("Msxml2.XMLHTTP");
         } catch (e) {
            try {
               KMhttp_request = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
         }
      }
      if (!KMhttp_request) {
         alert('Cannot create XMLHTTP instance');
         return false;
      }
      KMhttp_request.onreadystatechange = KMalertContents;
      lasturl = url + parameters;
      lasturlcount = 10;
      if (method == 'POST')
	      KMhttp_request.open('POST', url, true);
      else
	      KMhttp_request.open('GET', url + parameters, true);
      markYellow();
	//document.getElementById('ind').className = 'yellow';
      KMhttp_request.send(parameters);
   }
   function alertContents() {
	   try{
           if (http_request.responseText != ''){
		    //  show_in_dialog(http_request.responseText);
            $("#dialog-confirm2").show();
            $( "#dialog-confirm2" ).dialog({
                                          resizable: false,
                                          height:140,
                                          modal: true,
                                          buttons: {
                                          "取消": function() {
                                          $( this ).dialog( "close" );
                                          },
                                          "返回首页": function() {
                                          //$( this ).dialog( "close" );
                                          window.location.href="http://yunphone.shinegame.cn/webh5";
                                          }
                                          },
                                          close: function(event) {
                                          $("#dialog-confirm2").hide();
                                          }
                                          });
           }
	   } catch (e) {};
      if (http_request.readyState == 4) {
         if (http_request.status == 200) {
		 markGreen();
		//document.getElementById('ind').className = 'green';
         }
	 else
	 {
		 markRed();
		 //document.getElementById('ind').className = 'red';
	 }
      }
   }
   function KMalertContents() {
      if (KMhttp_request.readyState == 4) {
         if (KMhttp_request.status == 200) {
		 markGreen();
		//document.getElementById('ind').className = 'green';

		wait = false;
		if (Kqueue)
		{
			keyLater();
		}
		else
		{
			if (Mqueue)
			{
				moveLater();
			}
		}
         }
	 else
	 {
		 markRed();
		 //document.getElementById('ind').className = 'red';
		 if (lasturlcount == 0)
		 {
			wait = false;
			if (Kqueue)
			{
				keyLater();
			}
			else
			{
				if (Mqueue)
				{
					moveLater();
				}
			}
		 }
		 else
		 {
			 var l = lasturlcount-1;
			 KMmakeRequest(lasturl,'','');
			 lasturlcount = l;
		 }
	 }
      }
   }
function mytimer()
{
	if (document.getElementById('kalive').checked==true)
	keepAlive();
	setTimeout("mytimer()",14000);
}
setTimeout("mytimer()",1500);
function sendkey(e) {
	var evtobj=window.event? event : e; //distinguish between IE's explicit event object (window.event) and Firefox's implicit.
	var unicode=evtobj.charCode? evtobj.cd  : -evtobj.keyCode;
	if (unicode == 8)
		unicode = -8;
	if (unicode == -8 && ignore_backspace > 0)
		ignore_backspace -= 1;
	else
	{
		if (typeof evtobj.charCode === 'undefined')
			submitkey(unicode,true);
		else
			submitkey(unicode,false);
	}
}
function submitkey(unicode,old)
{
	if (unicode == -13)
		unicode = 13;
//	if (document.getElementById('sendonenter').checked==true && unicode == 13)
//	{
//		setTimeout("resend();document.getElementById('text').value = ''",0);
//		return;
//	}
//	if (document.getElementById('sendtyping').checked==false)
//		return;
	if (unicode == -10)
		unicode = 10;
//	if (unicode == 13)
//		unicode = 10;
	var t = 'injkey';
//	if (document.getElementById('old').checked==true)
//		t = 'oldkey';
	if (old==true)
		t = 'oldkey';
	if (document.getElementById('orient').checked==true)
		t = t+'h';
	else
		t = t+'v';
//	if (document.getElementById('sms').checked==true)
//		t = t+'s';
//	else
		t = t+'n';
	if (wait == false)
	{
		KMmakeRequest(t+'_'+unicode,'','');
		wait = true;
		keyq = t;
	}
	else
	{
		if (Kqueue == true)
			keyq = keyq + '_' + unicode;		
		else
			keyq = t+'_'+unicode;
		Kqueue = true;
	}
}
function keyLater()
{
	KMmakeRequest(keyq,'','');
	keyq = '';
	Kqueue = false;
	wait = true;
}
function keepAlive()
{
	makeRequest('button_28',''); //send CLEAR to keep alive
}
function keyDown(e)
{
    if (e.ctrlKey && e.keyCode == 13) {
        // Ctrl-Enter pressed
        resend();
    }else{
        isBackspace(e);
    }
}
function keyUp(e)
{
}
function isBackspace(e)
{
	var evtobj=window.event? event : e //distinguish between IE's explicit event object (window.event) and Firefox's implicit.
	if (evtobj.keyCode == 8)
	{
//		makeRequest('button_67','');//DEL
		ignore_backspace += 1;
		submitkey(-8,false);
		return false;
	}
//	if (evtobj.keyCode == 13)
//	{
//		makeRequest('button_66','');//ENTER
//	}
}
function intent(act,dat)
{
	var addr = 'intent';
	var st='-a '+act+' -d '+dat;
	var l=st.length;
	var i = 0;
	for (i = 0; i < l; i++)
		addr += '_'+st.charCodeAt(i);
	makeRequest(addr,'');
}
function runline(st)
{
	var addr = 'run';
	var l=st.length;
	var i = 0;
	for (i = 0; i < l; i++)
		addr += '_'+st.charCodeAt(i);
	makeRequest(addr,'');
}
function cleartext()
{
	if (firsttype && document.getElementById('text').value == "`Click here to type on phone!`")
	{
		document.getElementById('text').value = "" ;
	}
	firsttype = false;
}
function call(number)
{
	var st = 'service call phone 2 s16 "'+number+'"';
	var addr = 'run';
	var l=st.length;
	var i = 0;
	for (i = 0; i < l; i++)
		addr += '_'+st.charCodeAt(i);
	makeRequest(addr,'');
}
function resend()
{
	var st =  '{msg_type:"webkey_input",content:"'+document.getElementById('text').value+'"}';
	var l = st.length;
	var i = 0;
	var t = 'injkey';
	if (document.getElementById('orient').checked==true)
		t = t+'h';
	else
		t = t+'v';
//	if (document.getElementById('sms').checked==true)
//		t = t+'s';
//	else
		t = t+'n';
//	for (i = 0; i < l; i++)
//		t = t + '_'+st.charCodeAt(i);
//	makeRequest(t,'');
	$.ajax({
		url: t,
		dataType: 'text',
		data: st,
		type: 'POST',
		cache: false,
		timeout: 5000,
        success: function(){ document.getElementById('text').value = "";}
	});
}
function checklowres()
{
	if (document.getElementById('halfsize').checked)
		document.getElementById('lowres').checked = true;
	refreshImage(false);
}
function checklowresnew()
{
    refreshImage(false);
}
function arrows_move(event)
{
	var top = 0;
	var left = 0;
	var ob = document.images['arrows'];
	do{
		left += ob.offsetLeft;
		top += ob.offsetTop;
		ob = ob.offsetParent;
	}while (ob);
	var x = event.offsetX?(event.offsetX):event.pageX-left;
	var y = event.offsetY?(event.offsetY):event.pageY-top;
	if (x < 11 && x < y && x < 36-y)
	{
		document.images['arrows'].src = 'left.png';
		return;
	}
	if (y < 11 && y < 36-x)
	{
		document.images['arrows'].src = 'up.png';
		return;
	}
	if (x > 24  && y < x)
	{
		document.images['arrows'].src = 'right.png';
		return;
	}
	if (y > 24)
	{
		document.images['arrows'].src = 'down.png';
		return;
	}
	document.images['arrows'].src = 'center.png';
}
function arrow_left()
{
	if (document.getElementById('orient').checked==true)
		makeRequest('button_19','');
	else
		makeRequest('button_21','');
}
function arrow_up()
{
	if (document.getElementById('orient').checked==true)
		makeRequest('button_22','');
	else
		makeRequest('button_19','');
}
function arrow_down()
{
	if (document.getElementById('orient').checked==true)
		makeRequest('button_21','');
	else
		makeRequest('button_20','');
}
function arrow_right()
{
	if (document.getElementById('orient').checked==true)
		makeRequest('button_20','');
	else
		makeRequest('button_22','');
}
function arrows_down(event)
{
	var top = 0;
	var left = 0;
	var ob = document.images['arrows'];
	do{
		left += ob.offsetLeft;
		top += ob.offsetTop;
		ob = ob.offsetParent;
	}while (ob);
	var x = event.offsetX?(event.offsetX):event.pageX-left;
	var y = event.offsetY?(event.offsetY):event.pageY-top;
	if (x < 11 && x < y && x < 36-y)
	{
		if (document.getElementById('orient').checked==true)
			makeRequest('button_19','');
		else
			makeRequest('button_21','');
		return;
	}
	if (y < 11 && y < 36-x)
	{
		if (document.getElementById('orient').checked==true)
			makeRequest('button_22','');
		else
			makeRequest('button_19','');
		return;
	}
	if (x > 24  && y < x)
	{
		if (document.getElementById('orient').checked==true)
			makeRequest('button_20','');
		else
			makeRequest('button_22','');
		return;
	}
	if (y > 24)
	{
		if (document.getElementById('orient').checked==true)
			makeRequest('button_21','');
		else
			makeRequest('button_20','');
		return;
	}
	makeRequest('button_23','');
}
function arrows_out()
{
	document.images['arrows'].src = 'arrows.png';
}

//document.getElementById('lowres').checked = getCookie("lowres");
function updatecookies()
{
	setCookie("lowres",document.getElementById('lowres').checked?'true':'false',30);
	setCookie("halfsize",document.getElementById('halfsize').checked?'true':'false',30);
	setCookie("orient",document.getElementById('orient').checked?'true':'false',30);
}
function autorefresh()
{
	if (document.getElementById('auto').checked==true)
		refreshImage(false)
}
function recordImages()
{
	if (recording == false)
	{
		recording = true;
		var t = 'jpg';
		var or = document.getElementById('orient').checked?'h':'v';
		var lowr = document.getElementById('lowres').checked?'l':'n';
		var f = 'n';
		var fli = 'n';
		recordmakeRequest('startrecord'+t+'?'+or+lowr+f+fli,'');
		document.getElementById('recbut').value="`Stop recording`";
	}
	else
	{
		recording = false;
		document.getElementById('recbut').value="Record images";
		window.location = 'finishrecord';
	}
	refreshImage(false);
}
function adjust(i)
{
	lightmakeRequest("adjust_light_"+i,"");
}	
function saveTime()
{
	var date = new Date();
	lastClick = date.getTime();
}
function requestWithTime(request)
{
	var date = new Date();
	var t = date.getTime()-lastClick;
	if (t > 4000)
		t = '/';
	makeRequest(request+'_'+t,'');
}

</script>


<div class="main" style="height:100%;width:100%">
<!-- <div class="leftpart" style="float:left"> -->
<div border="0" style="width:100%;height:100%;table-layout:fixed">
	<col width="100%">
	<col width="260">
<div>
    
    <div id="header-fixed" class="header-light">
        <a class="header-logo" href="#"></a>
    </div>
<div valign="top">
	<div id="imgholder" class="">
        <div id="btn_area">
            <button class="phone_btn" onclick="downloadGameBtnTap()">下载游戏</button>
            <button class="phone_btn" onclick="getPresentBtnTap()">领取礼包</button>
        </div>
		<div class="aboveimg"> </div>
		<canvas class="kep" src="" id="screenshot" align="left" ondragstart="return false">
<!--            <div id="testdata" style="position: fixed; color: red;"></div>-->
        </canvas>

	</div> <!-- end of imgholder -->
	<div id="right_menu" style="overflow: auto;height: 100%;"> <!-- textarea -->
		<div id="leftside"></div>
		<textarea id="text" placeholder="点击此处输入文字" cols="50" rows="10" style="float:left; margin-top:10px: clear: right;"
			onkeydown="keyDown(event);"
			onkeyup="keyUp(event);" onfocus="cleartext()"></textarea>
		<div style="clear:left"></div>
		<div id="gameres" style="float:left"></div>
		<div style="clear:left"></div>
		<div class="widget-container">
			<input id="resendbutton" type="button" style="margin-top: 20px" class="butt" value="发送" onclick="resend()"><br>
		</div>
        <div class="half-container">
		<div class="widget-container" id="lowreswidget">
			<input type="checkbox" id="lowres" onclick="updatecookies()"><label class="checkbox-label" for="lowres">低分辨率</label></div>
        <div class="widget-container" id="halfsizewidget">
            <input type="checkbox" id="halfsize" onclick="checklowres();updatecookies()">`Half size`</input></div>
		<div class="widget-container" id="halfsizewidgetnew" style="display:none;">
			<input type="checkbox" id="halfsizenew" onclick="checklowresnew();" checked><label class="checkbox-label" for="halfsizenew">缩小尺寸</label></input></div>
        
        <div class="widget-container">
            <input type="checkbox" id="orient" onclick="refreshImage(false);updatecookies()"><label class="checkbox-label" for="orient">水平放置</label></div>
        </div>
		<input type="button" class="butt" style="margin-top:20px" value="刷新图像" onclick="refreshImage(false)"><br>
		<a href="http://yunphone.shinegame.cn/webh5/index.html"><input type="button" class="butt" style="margin-top:20px" value="返回首页"></a>
	</div>
	<div id="res">`results`</div>
</div>
</div>
</div>


</div>
<script type="text/javascript" src="http://cdnyunphone.shinegame.cn/device/test/assets/js/_main.js"></script>
<script type="text/javascript" src="http://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500095337" ></script>
</body>
</html>
